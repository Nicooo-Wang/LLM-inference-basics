# 主题一：推理全流程串讲（概览篇）

## 1. 课程目标

在正式开始之前，我想先说明一下这篇教程希望达成的目标：

- **理解 vLLM 的核心设计理念**：为什么要专门搞一个推理引擎，而不是直接拿 PyTorch 写个 generate 循环就完事？这背后涉及到传统方法遇到的实实在在的性能瓶颈，以及 vLLM 如何用一套受操作系统启发的设计来解决这些问题。

- **理清推理流程的全生命周期**：一个 prompt 进来之后，到底经历了哪些步骤才变成最终输出？我们会从头到尾追踪一条请求在系统里的完整旅程。

- **熟悉 nano-vllm 的核心架构**：nano-vllm 是一个轻量级的 vLLM 实现，用大约 1200 行 Python 代码实现了可读性很强的代码库，同时保持了与 vLLM 相当的推理速度。我们会了解它的核心模块划分以及各模块之间的协作关系。

---

## 2. 核心内容

### 一、vLLM 解决的核心痛点

如果你之前用过 Hugging Face Transformers 做推理，可能会发现一个尴尬的现象：GPU 显存占用很高，但实际利用率却时高时低，吞吐量也上不去。这不是你的代码有问题，而是传统推理方式本身就存在几个根本性的局限。

#### 1.1 传统推理的三大痛点


**痛点一：KV Cache 的显存碎片化**

在自回归解码过程中，每个 token 都会生成对应的 Key 和 Value 向量，这些缓存需要保存在 GPU 显存中。传统方法为每个请求分配一块连续的内存空间。

问题在于，当某些请求完成并释放内存后，会在显存中留下不连续的"空洞"。新来的请求如果需要比这些空洞更大的连续空间，就无法利用这些已释放的内存——这与早期操作系统面临的内存碎片化问题如出一辙。

![pic](https://ucc.alicdn.com/pic/developer-ecology/5i77ajz5u7ji6_7a222d065eae4de7b3dba909b3ad8dc2.png?x-oss-process=image%2Fresize%2Cw_1400%2Cm_lfit%2Fformat%2Cwebp)

**痛点二：静态批处理的低效**

传统的批处理方式是"静态"的：凑齐一批请求，等整个 batch 全部完成，再接收下一批。问题是，不同请求的输出长度差异可能非常大——有的请求生成 10 个 token 就结束了，有的要生成 500 个。

这导致了一个荒谬的局面：先完成的请求不得不"陪跑"，占着显存干等其他请求。GPU 利用率随着请求逐个完成而不断下降，直到整个 batch 结束后才能恢复。

![pic](https://pic2.zhimg.com/v2-2f74fca7aee43652f5b600e9fd4328bd_1440w.jpg)

**痛点三：预分配造成的浪费**

因为系统无法预知一个请求最终会生成多少 token，只能按最大可能长度预分配 KV Cache。一个请求哪怕只生成了 50 个 token，也可能占着 2048 个 token 的显存空间。

paged attention paper中，经过调查，由于系统因为内存碎片和过度预留，浪费了 60% - 80% 的显存。这意味着你花了 80GB 显存的钱，实际只用上了 16-32GB
![pic](https://developer.qcloudimg.com/http-save/yehe-4941972/edcec61c43f5dd1b2f59a62782492f4f.png)

---

#### 1.2 vLLM 的突破性创新

针对这些痛点，vLLM 提出了两个核心创新：PagedAttention 和连续批处理。


**创新一：PagedAttention（分页注意力）**

PagedAttention 的核心思想直接借鉴了操作系统的虚拟内存管理。在操作系统中，程序看到的是连续的虚拟地址空间，但实际的物理内存页可以分散存放在任何位置，通过页表来维护映射关系。

vLLM 将这个思想应用到 KV Cache 管理上：每个序列的 KV Cache 被分割成固定大小的"块"，每个块包含固定数量 token 的 Key 和 Value。这些物理块可以在 GPU 显存中非连续存放，通过 Block Table 维护逻辑块到物理块的映射。

这样一来，内存碎片问题就彻底解决了——因为所有块大小相同，任何空闲块都可以被任何需要新块的请求使用。浪费只发生在每个序列的最后一个块（因为最后一个块可能没有填满）。

![pic](https://terenceli.github.io/assets/img/vllmpageattn/1.png)

**创新二：连续批处理（Continuous Batching）**

连续批处理打破了传统的"等待整个 batch 完成"的模式。在每个推理迭代步骤：首先检查是否有请求完成（遇到 EOS 或达到最大长度），将其移出运行队列并释放资源；然后检查等待队列中是否有新请求可以调度，如果有足够的资源就将其加入运行队列。

这样，GPU 可以始终保持接近满载的状态。一个请求完成后，它的资源立即被回收并分配给等待中的请求，不存在"陪跑"的浪费。

without continious batching
![pic]( https://images.ctfassets.net/xjan103pcp94/1LJioEsEdQQpDCxYNWirU6/82b9fbfc5b78b10c1d4508b60e72fdcf/cb_02_diagram-static-batching.png)
with continious batching
![pic](https://images.ctfassets.net/xjan103pcp94/744TAv4dJIQqeHcEaz5lko/b823cc2d92bbb0d82eb252901e1dce6d/cb_03_diagram-continuous-batching.png)
---

#### 1.3 nano-vllm 

[nano-vllm](https://github.com/GeeeekExplorer/nano-vllm) 是一个轻量级的 vLLM 实现，专为学习和理解 vLLM 核心思想而设计。它用约 1200 行干净的 Python 代码实现了 vLLM 的核心功能，同时保留了关键的性能优化组件。

nano-vllm 的特点包括：剥离了复杂的底层 C++/CUDA 代码，专注于核心调度算法的 Python 实现；使用 Flash Attention 和 Triton kernels 保证推理速度；支持 Continuous Batching、PagedAttention、前缀缓存、张量并行等核心特性。

简单来说，如果你想理解 vLLM 的核心思想而不是被底层优化细节淹没，nano-vllm 是一个理想的学习起点。

---

### 二、系统架构概览

下面这张架构图展示了 nano-vllm/vLLM 的核心类及其依赖关系。特别注意在多卡（Tensor Parallel）场景下，哪些类是单实例的，哪些是多实例的。
![图 3](../.assets/acfa637ac6a726b537f883247f453c85a441fe5a0251dba126839fdcc76f6a58.png)  


以下是各个组件及其在多卡场景下的实例分布：

**单实例组件（全局唯一）**

这些组件在整个系统中只有一个实例，负责全局的协调和管理工作：

- **LLMEngine**：系统的总控制器，持有 Scheduler 和 Worker 的引用。它的 `step()` 方法是整个推理循环的驱动核心。无论有多少张 GPU，只需要一个 Engine 来协调它们。

- **Scheduler**：全局的调度器，维护 Waiting、Running、Finished 三个队列。它需要对所有请求有全局视图，因此只能是单实例。

- **BlockManager**：管理 KV Cache 的物理块分配。虽然物理块分布在多张 GPU 上，但块的分配和映射决策是中心化的，因此 BlockManager 是单实例的。

**多实例组件（每 GPU 一个）**

这些组件在每张 GPU 上都有独立的实例：

- **Worker**：每张 GPU 上有一个 Worker 实例，负责在该 GPU 上执行计算。Worker 持有该 GPU 上的 KV Cache 张量和模型分片。

- **Model**：在张量并行（Tensor Parallel）场景下，模型的权重被切分到多张 GPU 上。每张 GPU 上有一个 Model 实例，持有权重的一个分片。

**核心数据结构**

- **SequenceGroup**：封装一个请求的完整状态，包括 prompt tokens、已生成的 tokens、采样参数、当前状态（Waiting/Running/Finished）等。

- **BlockTable**：每个 SequenceGroup 有自己的 BlockTable，记录逻辑块到物理块的映射。

- **KVCache**：预分配在 GPU 显存中的张量，按块组织，存储所有序列的 Key 和 Value。

- **SamplingParams**：采样配置参数，如温度、top_p、max_tokens 等。

---

### 三、一条请求的全流程拆解

现在让我们跟踪一条请求从输入到输出的完整生命周期，包括 Tokenization 和 Detokenization 的细节。
![图 4](../.assets/ea90907cad41b02e07ac9d1fea1df490797315b93e21c584797b228f7ad33922.png)  


#### 关于 Tokenizer：文本与 Token 的桥梁

Tokenizer 是 LLM 推理流程中不可或缺的组件，它负责文本和 Token ID 之间的双向转换。

**Tokenization**

Tokenization 将自然语言文本转换为 Token ID 序列。现代 LLM 通常使用子词分词算法，如 BPE（Byte Pair Encoding）、WordPiece 或 SentencePiece。这些算法能够平衡词汇表大小和表示能力——常见词可能是一个 token，而罕见词则被拆分成多个子词 token。

例如，对于输入 "深度学习是人工智能的核心技术"，不同的分词结果可能是：按字分词得到单独的字符 token，或者按子词分词将 "深度"、"学习"、"人工智能" 等常见组合作为单个 token。

**Detokenization**

Detokenization 是 Tokenization 的逆过程，将 Token ID 序列转换回人类可读的文本。需要注意的是，由于分词算法的特性（比如 BPE 的合并规则），detokenization 需要正确处理子词边界和特殊字符。

**nano-vllm 中的实现**

nano-vllm 使用 HuggingFace Transformers 的 Tokenizer。在代码中，tokenization 发生在请求进入系统时（`engine.py` 中的 `add_request` 方法），detokenization 发生在请求完成时。

```python
# Tokenization
token_ids = tokenizer.encode("你好，世界")  # [12043, 8834, 1922]

# Detokenization
text = tokenizer.decode([12043, 8834, 1922])  # "你好，世界"
```

---

### 四、Prefill 与 Decode 的差异化处理

Prefill 和 Decode 是 LLM 推理中两个计算特性截然不同的阶段。理解它们的差异对于优化推理性能至关重要。

<iframe src="data:text/html;charset=utf-8;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InpoIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+UHJlZmlsbCB2cyBEZWNvZGU8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgICogeyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgUm9ib3RvLCBzYW5zLXNlcmlmOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMGYxNzJhIDAlLCAjMWUyOTNiIDEwMCUpOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgcGFkZGluZzogMjBweDsKICAgICAgICB9CiAgICAgICAgLmNvbnRhaW5lciB7IG1heC13aWR0aDogOTUwcHg7IG1hcmdpbjogMCBhdXRvOyB9CiAgICAgICAgaDEgewogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGNvbG9yOiAjZmZmOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAzMHB4OwogICAgICAgICAgICBmb250LXNpemU6IGNsYW1wKDEuMnJlbSwgNHZ3LCAxLjZyZW0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAucGhhc2UtY29udGFpbmVyIHsKICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOwogICAgICAgICAgICBnYXA6IDI0cHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgICAgICAgfQogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NTBweCkgewogICAgICAgICAgICAucGhhc2UtY29udGFpbmVyIHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnBoYXNlLWNhcmQgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMDMpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICAgICAgICBwYWRkaW5nOiAyNHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpOwogICAgICAgIH0KICAgICAgICAucGhhc2UtaGVhZGVyIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMTZweDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsKICAgICAgICB9CiAgICAgICAgLnBoYXNlLWljb24geyBmb250LXNpemU6IDIuNXJlbTsgbWFyZ2luLWJvdHRvbTogOHB4OyB9CiAgICAgICAgLnBoYXNlLXRpdGxlIHsgZm9udC1zaXplOiAxLjJyZW07IGZvbnQtd2VpZ2h0OiA2MDA7IG1hcmdpbi1ib3R0b206IDRweDsgfQogICAgICAgIC5wcmVmaWxsLWNhcmQgLnBoYXNlLXRpdGxlIHsgY29sb3I6ICM4YjVjZjY7IH0KICAgICAgICAuZGVjb2RlLWNhcmQgLnBoYXNlLXRpdGxlIHsgY29sb3I6ICNmNTllMGI7IH0KICAgICAgICAucGhhc2Utc3VidGl0bGUgeyBjb2xvcjogIzY0NzQ4YjsgZm9udC1zaXplOiAwLjg1cmVtOyB9CiAgICAgICAgCiAgICAgICAgLyog5rOo5oSP5Yqb55+p6Zi15Y+v6KeG5YyWICovCiAgICAgICAgLmF0dGVudGlvbi12aXogewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7CiAgICAgICAgfQogICAgICAgIC52aXotdGl0bGUgewogICAgICAgICAgICBjb2xvcjogIzk0YTNiODsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjc1cmVtOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgfQogICAgICAgIC5tYXRyaXgtY29udGFpbmVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICB9CiAgICAgICAgLmF4aXMtbGFiZWwgewogICAgICAgICAgICBjb2xvcjogIzY0NzQ4YjsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjY1cmVtOwogICAgICAgICAgICB3cml0aW5nLW1vZGU6IHZlcnRpY2FsLXJsOwogICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIC5tYXRyaXgtd3JhcHBlciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIC5tYXRyaXggewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBnYXA6IDJweDsKICAgICAgICB9CiAgICAgICAgLnByZWZpbGwtbWF0cml4IHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoNiwgMWZyKTsgfQogICAgICAgIC5kZWNvZGUtbWF0cml4IHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoNywgMWZyKTsgfQogICAgICAgIC5tYXRyaXgtY2VsbCB7CiAgICAgICAgICAgIHdpZHRoOiAyOHB4OwogICAgICAgICAgICBoZWlnaHQ6IDI4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC41NXJlbTsKICAgICAgICAgICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC43KTsKICAgICAgICB9CiAgICAgICAgLmNlbGwtYWN0aXZlIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzhiNWNmNiwgIzYzNjZmMSk7IH0KICAgICAgICAuY2VsbC1jb21wdXRlIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2Y1OWUwYiwgI2VhNTgwYyk7IH0KICAgICAgICAuY2VsbC1jYWNoZWQgeyBiYWNrZ3JvdW5kOiAjMzM0MTU1OyBjb2xvcjogIzY0NzQ4YjsgfQogICAgICAgIC5jZWxsLW1hc2sgeyBiYWNrZ3JvdW5kOiAjMWUyOTNiOyBjb2xvcjogIzM3NDE1MTsgfQogICAgICAgIC5jZWxsLW5ldyB7IAogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMTBiOTgxLCAjMDU5NjY5KTsgCiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMCA4cHggcmdiYSgxNiwgMTg1LCAxMjksIDAuNSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC50b2tlbi1sYWJlbHMgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBnYXA6IDJweDsKICAgICAgICAgICAgbWFyZ2luLXRvcDogNnB4OwogICAgICAgIH0KICAgICAgICAudG9rZW4tbGFiZWwgewogICAgICAgICAgICB3aWR0aDogMjhweDsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBmb250LXNpemU6IDAuNTVyZW07CiAgICAgICAgICAgIGNvbG9yOiAjNjQ3NDhiOwogICAgICAgIH0KICAgICAgICAudG9rZW4tbGFiZWwtbmV3IHsgY29sb3I6ICMxMGI5ODE7IGZvbnQtd2VpZ2h0OiA2MDA7IH0KICAgICAgICAKICAgICAgICAvKiDorqHnrpfph4/mjIfnpLogKi8KICAgICAgICAuY29tcHV0ZS1pbmRpY2F0b3IgewogICAgICAgICAgICBtYXJnaW4tdG9wOiAxNnB4OwogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMik7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICB9CiAgICAgICAgLmNvbXB1dGUtcm93IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiAxMHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA4cHg7CiAgICAgICAgfQogICAgICAgIC5jb21wdXRlLWxhYmVsIHsKICAgICAgICAgICAgY29sb3I6ICM2NDc0OGI7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsKICAgICAgICAgICAgd2lkdGg6IDgwcHg7CiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgIH0KICAgICAgICAuY29tcHV0ZS1iYXIgewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICBoZWlnaHQ6IDIwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMxZTI5M2I7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQogICAgICAgIC5jb21wdXRlLWZpbGwgewogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogOHB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuN3JlbTsKICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgfQogICAgICAgIC5maWxsLWNvbXB1dGUgeyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICM4YjVjZjYsICM2MzY2ZjEpOyB9CiAgICAgICAgLmZpbGwtbWVtb3J5IHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZjU5ZTBiLCAjZWE1ODBjKTsgfQogICAgICAgIAogICAgICAgIC8qIOeJueaAp+WIl+ihqCAqLwogICAgICAgIC5mZWF0dXJlLWxpc3QgewogICAgICAgICAgICBtYXJnaW4tdG9wOiAxNnB4OwogICAgICAgIH0KICAgICAgICAuZmVhdHVyZS1pdGVtIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7CiAgICAgICAgICAgIGdhcDogOHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuODVyZW07CiAgICAgICAgICAgIGNvbG9yOiAjOTRhM2I4OwogICAgICAgIH0KICAgICAgICAuZmVhdHVyZS1pY29uIHsgZmxleC1zaHJpbms6IDA7IH0KICAgICAgICAucHJlZmlsbC1jYXJkIC5mZWF0dXJlLWljb24geyBjb2xvcjogIzhiNWNmNjsgfQogICAgICAgIC5kZWNvZGUtY2FyZCAuZmVhdHVyZS1pY29uIHsgY29sb3I6ICNmNTllMGI7IH0KICAgICAgICAKICAgICAgICAvKiDluo/liJfml7bpl7Tnur8gKi8KICAgICAgICAuc2VxdWVuY2UtdGltZWxpbmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMDMpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxNnB4OwogICAgICAgICAgICBwYWRkaW5nOiAyNHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpOwogICAgICAgIH0KICAgICAgICAudGltZWxpbmUtdGl0bGUgewogICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICAgICAgZm9udC1zaXplOiAxcmVtOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIC50aW1lbGluZS12aXogewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgfQogICAgICAgIC5zZXEtcm93IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDsKICAgICAgICB9CiAgICAgICAgLnNlcS1sYWJlbCB7CiAgICAgICAgICAgIGNvbG9yOiAjNjQ3NDhiOwogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgICAgIHdpZHRoOiA3MHB4OwogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICB9CiAgICAgICAgLnNlcS10b2tlbnMgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBnYXA6IDNweDsKICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAgIH0KICAgICAgICAuc2VxLXRva2VuIHsKICAgICAgICAgICAgd2lkdGg6IDMycHg7CiAgICAgICAgICAgIGhlaWdodDogMzJweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjY1cmVtOwogICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICB9CiAgICAgICAgLnRvay1wcm9tcHQgeyBiYWNrZ3JvdW5kOiAjMzM0MTU1OyB9CiAgICAgICAgLnRvay1wcmVmaWxsIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzhiNWNmNiwgIzYzNjZmMSk7IH0KICAgICAgICAudG9rLWRlY29kZSB7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICNmNTllMGIsICNlYTU4MGMpOyB9CiAgICAgICAgLnRvay1jdXJyZW50IHsgCiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMxMGI5ODEsICMwNTk2NjkpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDE2LCAxODUsIDEyOSwgMC41KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnBoYXNlLWluZGljYXRvciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMTZweDsKICAgICAgICAgICAgcGFkZGluZy10b3A6IDE2cHg7CiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMSk7CiAgICAgICAgfQogICAgICAgIC5waGFzZS1iYWRnZSB7CiAgICAgICAgICAgIHBhZGRpbmc6IDZweCAxNHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgfQogICAgICAgIC5iYWRnZS1wcmVmaWxsIHsgYmFja2dyb3VuZDogcmdiYSgxMzksIDkyLCAyNDYsIDAuMik7IGNvbG9yOiAjYTc4YmZhOyB9CiAgICAgICAgLmJhZGdlLWRlY29kZSB7IGJhY2tncm91bmQ6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjIpOyBjb2xvcjogI2ZiYmYyNDsgfQogICAgICAgIAogICAgICAgIC8qIOWFrOW8j+ivtOaYjiAqLwogICAgICAgIC5mb3JtdWxhLWJveCB7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoOTksIDEwMiwgMjQxLCAwLjEpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDk5LCAxMDIsIDI0MSwgMC4zKTsKICAgICAgICB9CiAgICAgICAgLmZvcm11bGEtdGl0bGUgewogICAgICAgICAgICBjb2xvcjogIzgxOGNmODsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjg1cmVtOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgIH0KICAgICAgICAuZm9ybXVsYSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7CiAgICAgICAgICAgIGNvbG9yOiAjZTJlOGYwOwogICAgICAgICAgICBmb250LXNpemU6IDFyZW07CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgcGFkZGluZzogMTBweDsKICAgICAgICB9CiAgICAgICAgLmZvcm11bGEtZGVzYyB7CiAgICAgICAgICAgIGNvbG9yOiAjOTRhM2I4OwogICAgICAgICAgICBmb250LXNpemU6IDAuOHJlbTsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMTBweDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8aDE+4pqhIFByZWZpbGwgdnMgRGVjb2Rl77ya5Lik56eN6K6h566X5qih5byP55qE5a+55q+UPC9oMT4KICAgICAgICAKICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1jb250YWluZXIiPgogICAgICAgICAgICA8IS0tIFByZWZpbGwg6Zi25q61IC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1jYXJkIHByZWZpbGwtY2FyZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1oZWFkZXIiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBoYXNlLWljb24iPvCfmoA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS10aXRsZSI+UHJlZmlsbCDpooTloavlhYXpmLbmrrU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1zdWJ0aXRsZSI+5LiA5qyh5aSE55CG5a6M5pW0IFByb21wdDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImF0dGVudGlvbi12aXoiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZpei10aXRsZSI+QXR0ZW50aW9uIOiuoeeul++8muWujOaVtOeahCBOw5dOIOefqemYte+8iENhdXNhbCBNYXNr77yJPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImF4aXMtbGFiZWwiPlF1ZXJ5PGJyPihOIHRva2Vucyk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LXdyYXBwZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4IHByZWZpbGwtbWF0cml4Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyAxOiB0MCAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1tYXNrIj7DlzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLW1hc2siPsOXPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1tYXNrIj7DlzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyAyOiB0MSAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLW1hc2siPsOXPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1tYXNrIj7DlzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyAzOiB0MiAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtYWN0aXZlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLW1hc2siPsOXPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1tYXNrIj7DlzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyA0OiB0MyAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtYWN0aXZlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1tYXNrIj7DlzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyA1OiB0NCAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtYWN0aXZlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtbWFzayI+w5c8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyA2OiB0NSAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtYWN0aXZlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWFjdGl2ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1hY3RpdmUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtYWN0aXZlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9rZW4tbGFiZWxzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2tlbi1sYWJlbCI+dOKCgDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRva2VuLWxhYmVsIj504oKBPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9rZW4tbGFiZWwiPnTigoI8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2tlbi1sYWJlbCI+dOKCgzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRva2VuLWxhYmVsIj504oKEPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9rZW4tbGFiZWwiPnTigoU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iY29sb3I6IzY0NzQ4YjsgZm9udC1zaXplOjAuNjVyZW07IG1hcmdpbi10b3A6NHB4OyI+S2V5IChOIHRva2Vucyk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1pbmRpY2F0b3IiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXB1dGUtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbXB1dGUtbGFiZWwiPuiuoeeul+mHjzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1iYXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1maWxsIGZpbGwtY29tcHV0ZSIgc3R5bGU9IndpZHRoOjkwJTsiPk8oTsKyKSDnn6npmLXov5Dnrpc8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iY29tcHV0ZS1sYWJlbCI+6K6/5a2Y6YePPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb21wdXRlLWJhciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb21wdXRlLWZpbGwgZmlsbC1tZW1vcnkiIHN0eWxlPSJ3aWR0aDozMCU7Ij7kuK3nrYk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1saXN0Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmZWF0dXJlLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZmVhdHVyZS1pY29uIj7ilrg8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxzdHJvbmc+6K6h566X5a+G6ZuG5Z6LPC9zdHJvbmc+77ya5aSn6YePIEdFTU0g5pON5L2cPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlYXR1cmUtaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmZWF0dXJlLWljb24iPuKWuDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+5aSE55CGIE4g5LiqIHByb21wdCB0b2tlbnM8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZlYXR1cmUtaWNvbiI+4pa4PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj7nlJ/miJDlubblrZjlgqjlrozmlbQgS1YgQ2FjaGU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZlYXR1cmUtaWNvbiI+4pa4PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj7mr4/kuKror7fmsYLlj6rmiafooYzkuIDmrKE8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8IS0tIERlY29kZSDpmLbmrrUgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBoYXNlLWNhcmQgZGVjb2RlLWNhcmQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGhhc2UtaGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1pY29uIj7wn5SBPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGhhc2UtdGl0bGUiPkRlY29kZSDop6PnoIHpmLbmrrU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1zdWJ0aXRsZSI+5q+P5qyh5Y+q5aSE55CGIDEg5Liq5pawIFRva2VuPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXR0ZW50aW9uLXZpeiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idml6LXRpdGxlIj5BdHRlbnRpb24g6K6h566X77ya5LuF6K6h566X5pawIFRva2VuIOeahOS4gOihjO+8iDHDl07vvIk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY29udGFpbmVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXhpcy1sYWJlbCI+UXVlcnk8YnI+KDEgdG9rZW4pPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC13cmFwcGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeCBkZWNvZGUtbWF0cml4Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyAxLTY6IOW3sue8k+WtmO+8jOS4jemcgOmHjeaWsOiuoeeulyAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNhY2hlZCI+LTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY2FjaGVkIj4tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jYWNoZWQiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJvdyA3OiDmlrAgdG9rZW7vvIzlj6rorqHnrpfov5nkuIDooYwgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jb21wdXRlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNvbXB1dGUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY29tcHV0ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1jb21wdXRlIj7inJM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXRyaXgtY2VsbCBjZWxsLWNvbXB1dGUiPuKckzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hdHJpeC1jZWxsIGNlbGwtY29tcHV0ZSI+4pyTPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF0cml4LWNlbGwgY2VsbC1uZXciPk5FVzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2tlbi1sYWJlbHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRva2VuLWxhYmVsIj504oKAPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9rZW4tbGFiZWwiPnTigoE8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2tlbi1sYWJlbCI+dOKCgjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRva2VuLWxhYmVsIj504oKDPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9rZW4tbGFiZWwiPnTigoQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2tlbi1sYWJlbCI+dOKChTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRva2VuLWxhYmVsIHRva2VuLWxhYmVsLW5ldyI+dOKChjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjojNjQ3NDhiOyBmb250LXNpemU6MC42NXJlbTsgbWFyZ2luLXRvcDo0cHg7Ij5LZXkgKE4rMSB0b2tlbnMpPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXB1dGUtaW5kaWNhdG9yIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb21wdXRlLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjb21wdXRlLWxhYmVsIj7orqHnrpfph488L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXB1dGUtYmFyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXB1dGUtZmlsbCBmaWxsLWNvbXB1dGUiIHN0eWxlPSJ3aWR0aDoyMCU7Ij5PKE4pPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbXB1dGUtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbXB1dGUtbGFiZWwiPuiuv+WtmOmHjzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1iYXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29tcHV0ZS1maWxsIGZpbGwtbWVtb3J5IiBzdHlsZT0id2lkdGg6ODUlOyI+6K+75Y+W5a6M5pW0IEtWIENhY2hlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlYXR1cmUtbGlzdCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZlYXR1cmUtaWNvbiI+4pa4PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48c3Ryb25nPuiuv+WtmOWvhumbhuWeizwvc3Ryb25nPu+8muS4u+imgeaYryBLViBDYWNoZSDor7vlj5Y8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZlYXR1cmUtaWNvbiI+4pa4PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj7mr4/mrKHlj6rlpITnkIYgMSDkuKrmlrAgdG9rZW48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVhdHVyZS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZlYXR1cmUtaWNvbiI+4pa4PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj7pnIDopoEgUGFnZWRBdHRlbnRpb24g6K+75Y+W57yT5a2Y55qEIEtWPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlYXR1cmUtaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmZWF0dXJlLWljb24iPuKWuDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+5b6q546v5omn6KGM77yM55u05Yiw6YGH5Yiw57uI5q2i5p2h5Lu2PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDwhLS0g5bqP5YiX55Sf5oiQ5pe26Ze057q/IC0tPgogICAgICAgIDxkaXYgY2xhc3M9InNlcXVlbmNlLXRpbWVsaW5lIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idGltZWxpbmUtdGl0bGUiPvCfk4og5bqP5YiX55Sf5oiQ6L+H56iL55qE5rOo5oSP5Yqb6K6h566X5ryU5Y+YPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRpbWVsaW5lLXZpeiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtcm93Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtbGFiZWwiPlByZWZpbGw6PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VucyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJlZmlsbCI+6K+3PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJlZmlsbCI+6Kej6YeKPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJlZmlsbCI+5LuA5LmIPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJlZmlsbCI+5pivPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJlZmlsbCI+QUk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1jdXJyZW50IiB0aXRsZT0i6YeH5qC356ys5LiA5Liq6L6T5Ye6Ij7ihpIgPzwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtcm93Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtbGFiZWwiPkRlY29kZSAxOjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbnMiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+6K+3PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJvbXB0Ij7op6Pph4o8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPuS7gOS5iDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+5pivPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJvbXB0Ij5BSTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLWRlY29kZSI+5Lq65belPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stY3VycmVudCI+4oaSID88L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLWxhYmVsIj5EZWNvZGUgMjo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW5zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPuivtzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+6Kej6YeKPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJvbXB0Ij7ku4DkuYg8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPuaYrzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+QUk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPuS6uuW3pTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLWRlY29kZSI+5pm66IO9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stY3VycmVudCI+4oaSID88L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLWxhYmVsIj5EZWNvZGUgTjo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW5zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPuivtzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+Li4uPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJvbXB0Ij4uLi48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1wcm9tcHQiPi4uLjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLXByb21wdCI+Li4uPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcS10b2tlbiB0b2stcHJvbXB0Ij4uLi48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VxLXRva2VuIHRvay1kZWNvZGUiPuOAgjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXEtdG9rZW4gdG9rLWN1cnJlbnQiPkVPUzwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwaGFzZS1pbmRpY2F0b3IiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwaGFzZS1iYWRnZSBiYWRnZS1wcmVmaWxsIj7ntKvoibIgPSBQcmVmaWxsIOmYtuauteiuoeeulzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icGhhc2UtYmFkZ2UgYmFkZ2UtZGVjb2RlIj7mqZnoibIgPSBEZWNvZGUg6Zi25q616K6h566XPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDwhLS0g5YWs5byP6K+05piOIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm11bGEtYm94Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybXVsYS10aXRsZSI+8J+SoSDkuLrku4DkuYggRGVjb2RlIOmYtuauteaYr+iuv+WtmOWvhumbhuWei++8nzwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtdWxhIj4KICAgICAgICAgICAgICAgIEF0dGVudGlvbihRLCBLLCBWKSA9IHNvZnRtYXgoUUs8c3VwPlQ8L3N1cD4gLyDiiJpkKSDCtyBWCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtdWxhLWRlc2MiPgogICAgICAgICAgICAgICAg5ZyoIERlY29kZSDpmLbmrrXvvIxRIOWPquaciSAxIOihjO+8iOW9k+WJjSB0b2tlbu+8ie+8jOS9hiBLIOWSjCBWIOWMheWQq+aJgOacieWOhuWPsiB0b2tlbuOAguiuoeeul+mHj+aYryBPKE4p77yM5L2G6ZyA6KaB5LuO5pi+5a2Y5Lit6K+75Y+W5a6M5pW055qEIEtWIENhY2hl77yI5Y+v6IO95pWwIEdC77yJ44CC55Sx5LqOIEdQVSDnmoTmmL7lrZjluKblrr3ov5zkvY7kuo7orqHnrpfog73lipvvvIznk7bpoojlnKjkuo7lhoXlrZjor7vlj5bogIzpnZ7orqHnrpfigJTigJTov5nlsLHmmK/kuLrku4DkuYggUGFnZWRBdHRlbnRpb24g6IO95ZyoIERlY29kZSDpmLbmrrXlj5HmjKXlpoLmraTph43opoHnmoTkvZznlKjjgIIKICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KPC9ib2R5Pgo8L2h0bWw+" width="100%" style="border: none; width: 100%;" onload="this.style.height = 1200 + 'px'"></iframe>

**为什么 Prefill 是计算密集型的？**

在 Prefill 阶段，模型需要处理完整的 Prompt 序列。假设 prompt 有 N 个 token，那么注意力计算涉及一个 N×N 的矩阵（经过 causal mask 后是下三角矩阵）。这意味着：Query 矩阵形状为 [N, d]，Key 矩阵形状为 [N, d]，注意力分数计算 QK^T 的复杂度是 O(N²d)。这是大量的矩阵乘法运算，GPU 的 Tensor Core 可以充分发挥作用，算力利用率很高。

**为什么 Decode 是访存密集型的？**

到了 Decode 阶段，情况完全不同。每次迭代只有 1 个新 token 需要处理，Query 矩阵变成了 [1, d]。虽然这个 token 仍然需要与之前所有 token 计算注意力（K 和 V 的形状是 [N, d]），但计算量从 O(N²d) 下降到了 O(Nd)。

然而，我们仍然需要从显存中读取完整的 KV Cache。对于一个有 1000 个 token 的序列，这可能意味着数百 MB 甚至数 GB 的数据读取。由于 GPU 的计算能力远超显存带宽（比如 A100 的算力是 312 TFLOPS，但显存带宽只有 2 TB/s），瓶颈转移到了内存访问上。

**这对优化意味着什么？**

理解这种差异对于优化推理性能至关重要。Prefill 阶段可以通过增大 batch size 来提高吞吐量，因为它是计算密集型的。而 Decode 阶段由于每次只处理一个 token，单个请求很难打满 GPU——这正是连续批处理如此重要的原因：它允许我们在 Decode 阶段把多个请求的 token "打包"在一起执行，充分利用 GPU 的并行能力。

在 nano-vllm 的 `model.py` 中，你可以观察到对这两种模式的不同处理方式。Prefill 时使用标准的 Flash Attention，而 Decode 时使用 PagedAttention 从非连续的物理块中读取 KV Cache。

---

### 五、动手实践：nano-vllm 源码入口指引

理论讲完了，现在让我们实际看看代码。nano-vllm 的代码结构非常清晰，以下是几个关键入口点：

**`engine.py` - 找到系统的心跳**

打开 `engine.py`，找到 `step()` 函数。这是整个系统的主循环驱动。你会看到它大概做这些事情：调用 scheduler 决定本轮执行哪些请求，准备模型输入（构建 input_ids、positions 等），调用 worker 执行前向传播，采样得到下一个 token，更新各请求的状态。

**`scheduler.py` - 理解调度决策**

查看 `_schedule()` 方法的实现。你会看到它如何遍历 waiting 队列，检查 BlockManager 是否有足够的空闲块，然后决定哪些请求可以进入执行。

**`block_manager.py` - 初探分页内存管理**

这里实现了 PagedAttention 的核心数据结构。重点关注 `block_table` 的结构和作用。每个请求都有自己的 block_table，记录着逻辑块到物理块的映射。
